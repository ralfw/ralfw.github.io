<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Hamburg Style TDD - Bank Kata - One Man Think Tank</title><meta name="description" content=" There are already a few different styles of TDD out there. Still, though, my feeling is something is missing in the realm of test-first or test-driven development. I tried to explain that in my posting introducing the „Hamburg style TDD“. And then I showed&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://ralfw.github.io/homepage-ralfw-de/hamburg-style-tdd-bank-kata/"><link rel="alternate" type="application/atom+xml" href="https://ralfw.github.io/homepage-ralfw-de/feed.xml"><link rel="alternate" type="application/json" href="https://ralfw.github.io/homepage-ralfw-de/feed.json"><meta property="og:title" content="Hamburg Style TDD - Bank Kata"><meta property="og:image" content="https://ralfw.github.io/homepage-ralfw-de/media/website/logo-smaller.png"><meta property="og:site_name" content="One Man Think Tank"><meta property="og:description" content=" There are already a few different styles of TDD out there. Still, though, my feeling is something is missing in the realm of test-first or test-driven development. I tried to explain that in my posting introducing the „Hamburg style TDD“. And then I showed&hellip;"><meta property="og:url" content="https://ralfw.github.io/homepage-ralfw-de/hamburg-style-tdd-bank-kata/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://ralfw.github.io/homepage-ralfw-de/media/website/favicon.png" type="image/x-icon"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--logo-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--menu-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://ralfw.github.io/homepage-ralfw-de/assets/css/style.css?v=990e7ab6bf398e730fe544646c09fe50"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://ralfw.github.io/homepage-ralfw-de/hamburg-style-tdd-bank-kata/"},"headline":"Hamburg Style TDD - Bank Kata","datePublished":"2019-07-25T09:53","dateModified":"2021-01-25T16:26","image":{"@type":"ImageObject","url":"https://ralfw.github.io/homepage-ralfw-de/media/website/logo-smaller.png","height":53,"width":250},"description":" There are already a few different styles of TDD out there. Still, though, my feeling is something is missing in the realm of test-first or test-driven development. I tried to explain that in my posting introducing the „Hamburg style TDD“. And then I showed&hellip;","author":{"@type":"Person","name":"Ralf Westphal"},"publisher":{"@type":"Organization","name":"Ralf Westphal","logo":{"@type":"ImageObject","url":"https://ralfw.github.io/homepage-ralfw-de/media/website/logo-smaller.png","height":53,"width":250}}}</script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://ralfw.github.io/homepage-ralfw-de/"><img src="https://ralfw.github.io/homepage-ralfw-de/media/website/logo-smaller.png" alt="One Man Think Tank"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://ralfw.github.io/homepage-ralfw-de/focus/" target="_self">Focus</a></li><li><a href="https://ralfw.github.io/homepage-ralfw-de/approach/" target="_self">Approach</a></li><li class="has-submenu"><a href="https://ralfw.github.io/homepage-ralfw-de/trainings/" target="_self" aria-haspopup="true">Trainings</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://ralfw.github.io/homepage-ralfw-de/test-first-codierung/" target="_self">Test-first Codierung</a></li><li><a href="https://ralfw.github.io/homepage-ralfw-de/softwareentwurf-mit-flow-design/" target="_self">Softwareentwurf mit Flow-Design</a></li><li><a href="https://ralfw.github.io/homepage-ralfw-de/software-anforderungsanalyse-mit-slicing/" target="_self">Software Anforderungsanalyse mit Slicing</a></li></ul></li><li><a href="https://ralfw.github.io/homepage-ralfw-de/consulting/" target="_self">Consulting</a></li><li><a href="https://ralfw.github.io/homepage-ralfw-de/publications/" target="_self">Publications</a></li><li><a href="https://ralfw.github.io/homepage-ralfw-de/testimonials/" target="_self">Testimonials</a></li><li><a href="https://ralfw.github.io/homepage-ralfw-de/" target="_self">Blog</a></li><li class="has-submenu"><a href="https://ralfw.github.io/homepage-ralfw-de/about/" target="_self" aria-haspopup="true">About</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://ralfw.github.io/homepage-ralfw-de/imprint/" target="_self">Imprint</a></li><li><a href="https://ralfw.github.io/homepage-ralfw-de/data-privacy-policy-2/" target="_self">Privacy Policy</a></li></ul></li></ul></nav></header><main><article class="post"><div class="hero"><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2019-07-25T09:53">25.07.2019</time></div><h1>Hamburg Style TDD - Bank Kata</h1><div class="post__meta post__meta--author"><a href="https://ralfw.github.io/homepage-ralfw-de/authors/ralf-westphal/" class="feed__author invert">Ralf Westphal</a></div></div></header></div><div class="wrapper post__entry"><p></p><p>There are already a few different styles of TDD out there. Still, though, my feeling is something is missing in the realm of test-first or test-driven development. I tried to explain that in my posting introducing the „<a href="https://ralfw.de/2019/07/hamburg-style-tdd/" target="_blank" rel="noopener">Hamburg style TDD</a>“. And then I showed what that meant in practice in a second article <a href="https://ralfw.de/2019/07/hamburg-style-tdd-diamond-kata/" target="_blank" rel="noopener">applied to the Diamond kata</a>.</p><p></p><p></p><p>But knowing how hard it is to get the nuances (or even the obvious aspects) of a method across in writing (or with a video), I think I need to provide more examples of the application of Hamburg style TDD.</p><p></p><p></p><p>As a second example I’m choosing the kata Macro Emrich used to compare the established TDD styles: the Bank kata. If you like, check out Marco’s code samples in <a href="https://www.dropbox.com/s/94k73jylzprcbss/schools_of_tdd.pdf?dl=0" target="_blank" rel="noopener">this presentation</a> he did at the <a href="https://www.developer-week.de/" target="_blank" rel="noopener">DWX 2019 conference</a>.</p><p></p><p></p><p>Following I’ll share my version of the kata like I did with the Diamond kata. It differs from the Diamond kata in quite some aspects. Problem solving requires some breadth of approaches. Red-green-refactor + KISS is too simplistic.</p><p></p><p></p><h2>Problem description</h2><p></p><p></p><p>This is what I’ve distilled from descriptions of the Bank kata I found on the web. It’s a bit more specific than usual, I guess. But I like it that way. Without specific requirements software development is bound to become even more complex.</p><p></p><p></p><p>An excerpt from my in-project <code>.md</code> documentation of my „stream of consciousness“ while working on the problem:</p><p></p><p></p><pre class="wp-block-code"><code>A user should be able to deposit/withdraw funds from a bank 
account (object).
At any time a statement can be "printed" (requested) listing the 
timestamped transactions and the updated account balance.

Example:

`
Date       Amount  Balance
1.7.2019    +1000     1000
2.7.2019     -200      800
3.7.2019     +500     1300
`

Integer amounts are sufficient as are transaction timestamps with dates only.

No transaction is rejected, even if it leads to a negative account balance.
</code></pre><p></p><p></p><h2>1. Analysis</h2><p></p><p></p><p>With the problem description in hand I sit down and analyze it. I log my thoughts in a <code>.md</code> file. (The more I do that, the more I like it. It makes my thinking open for scrutiny.)</p><p></p><p></p><pre class="wp-block-code"><code>## Analysis
Essentially the problem is about an event stream for which a report 
is generated.

There are two commands:

* deposit
* withdraw

And a single query:

* print statement

For testing purposes and also as to not dilute the responsibility of 
the account the statement should not really be printed 
(output to a device), but just generated as a data structure.

For the timestamp the current time is used, ie. a dependency to the 
system is needed.

Transactions will not be persisted. An account's state will be limited 
to the lifetime of it's object.

### 1. Functions

#### Deposit command
`
void Deposit(int amount)
`

#### Withdraw command
`
void Withdraw(int amount)
`

#### Print statement query
`
Statement PrintStatement()
`

#### Classes
The request handling functions can be aggregated by a single class `Account`.

More classes are needed for the statement if access to the statement 
details is needed:

`
class Statement
    Transaction* Transactions
    
class Transaction
    DateTime Date // set by the Account class
    int Amount
    int Balance
`

### 2. Test Cases
`
Input  | State            || State'
Amount | Date   | Balance || Balance'
+100     1.1.19         0        100
+200     1.1.19       100        300
-50      2.1.19       300        250
-300     3.1.19       250        -50
`

This development of an account will be expressed in a growing 
statement (output) after each transaction:

`
v1
1.1.19,+100,100

v2
1.1.19,+100,100
1.1.19,+200,300

v3
1.1.19,+100,100
1.1.19,+200,300
2.1.19,-50,250

v4
1.1.19,+100,100
1.1.19,+200,300
2.1.19,-50,250
3.1.19,-300,-50
`

</code></pre><p></p><p></p><p>This time I came up with an acceptance test case of my own. It’s exercising not just one function, though, but all functions I derived from the requirements. The acceptance test thus is more like a whole use case.</p><p></p><p></p><p>Also note that this problem leads to several classes. In the Diamond kata classes were of no concern. But here they are needed to aggregate functions and data.</p><p></p><p></p><p>But the modularization is straightforward. It’s quite obvious, I’d say, because it is directly tied to the user’s needs. That’s why I would not say the classes are a product of design. I’m still in the analysis phase.</p><p></p><p></p><p>Maybe noteworthy is that I decided to not deliver a formatted textual account statement. Why should an account (object) care about report layout? It delivers a statement as a data structure some other part of a program can turn into a neatly layouted report.</p><p></p><p></p><p>Finally I encode my understanding:</p><p></p><p></p><div class="wp-block-image"><figure class="aligncenter"><figure class="wp-image-2698"><img loading="lazy" src="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/DraggedImage-18.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-18-xs.png 300w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-18-sm.png 480w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-18-md.png 768w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-18-lg.png 1024w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-18-xl.png 1360w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-18-2xl.png 1600w" alt="" width="1002" height="499"></figure></figure></div><p></p><p></p><p>There’s only one thing strange about this, I guess: why that kind of constructors on the <code>Account</code> class?</p><p></p><p></p><div class="wp-block-image"><figure class="aligncenter"><figure class="wp-image-2703"><img loading="lazy" src="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/DraggedImage-1-4.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-1-4-xs.png 300w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-1-4-sm.png 480w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-1-4-md.png 768w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-1-4-lg.png 1024w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-1-4-xl.png 1360w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-1-4-2xl.png 1600w" alt="" width="489" height="93"></figure></figure></div><p></p><p></p><p>During analysis I identified a dependency of my <em>system under test</em> (SUT, or system under development): It depends on the current date since the statement contains a date in each transaction, but requesting the transactions (<code>Deposit</code>, <code>Withdraw</code>) does not pass in a date.</p><p></p><p></p><p>How could an automated test running on an arbitrary date have an expectation regarding transaction dates? Without making „date acquisition“ configurable that would be hard. Hence the public ctor for production, and the internal for testing. The public one sees to that the current date is used; but the acceptance test uses the internal one to pass in a substitute function to deliver a date from a fixed set for each transaction.</p><p></p><p></p><p>That makes the test case a kind of whitebox test because it encodes an assumption about how many dates are required. But in this case that’s not severe, I’d say. Four transactions, four dates: that’s pretty obvious.</p><p></p><p></p><h2>2. Design</h2><p></p><p></p><p>Starting from the analysis I do some design. That’s not much, though. The problem is very simple. It’s just that I stop for a moment to gather my thoughts…</p><p></p><p></p><pre class="wp-block-code"><code>## 2. Design
The `Account` class pretty much is an event stream with an 
aggregator attached.

* The commands add events to the stream. No checking is needed, all 
amounts are ok. But the date is added to the tx.
* The statement is an aggregation of the events in the stream where 
the balance is constantly updated.

The main functionality is statement generation. And within that it's 
updating the balance. That suggests a function (or even class of its own).

The event stream is a simple append-only list for (internal) transcactions.

// Open question: What should happen if a negative amount is passed to 
// `Deposit()` or `Withdraw()`?
</code></pre><p></p><p></p><p>After that I feel comfortable to start the implementation.</p><p></p><p></p><h2>3. Implementation</h2><p></p><p></p><h3>Recording transactions</h3><p></p><p></p><p>This is an article about some form of test-first development. So what I’m doing here when I start the implementation of the <code>Account</code> class might seem horrible to you: I write logic without a test. I start with production code right away.&#x1f631;</p><p></p><p></p><p>But after my design recording transactions (functions <code>Deposit</code> and <code>Withdraw</code>) seems so simple that I don’t see much of a danger therein.</p><p></p><p></p><div class="wp-block-image"><figure class="aligncenter"><figure class="wp-image-2700"><img loading="lazy" src="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/DraggedImage-2-4.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-2-4-xs.png 300w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-2-4-sm.png 480w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-2-4-md.png 768w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-2-4-lg.png 1024w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-2-4-xl.png 1360w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-2-4-2xl.png 1600w" alt="" width="637" height="623"></figure></figure></div><p></p><p></p><p>There really is not much to test anyway. And if I wanted to test the effect of each function I would need to look under the hood of <code>Account</code>; it would only work with more whiteboxing.</p><p></p><p></p><p>So I reason that in the end the correctness of transaction recording will show up immediately during statement production: If statement production is working, but delivers the wrong statements, then something must be wrong with recording transactions. In that case I would closer at the transaction methods.</p><p></p><p></p><p>One word about the <code>Transaction</code> class inside of <code>Account</code>: It looks similar to the same named class inside of <code>Statement</code>. Why two classes for transactions? Because their „nature“ (or purpose) is different.</p><p></p><p></p><p><code>Statement.Transaction</code> is visible from the outside. It’s a class used for interaction with the system under development (a DTO). It’s subject to the user’s whim at any moment. I expect it to change due to changing requirements quite often.</p><p></p><p></p><p><code>Account.Transaction</code> on the other hand is an event object. It’s for recording what’s happening to the state of an <code>Account</code> object. (Never mind that it’s not phrased in the past tense.) This class is purely internal, an implementation detail. It’s not under direct stress from user requirements. I expect changing requirements not to lead to changes there, rather more events will be needed.</p><p></p><p></p><p>Two classes with the same name is simply a matter of decoupling. That’s a good architectural style. It’s clean code in my view.</p><p></p><p></p><p>Or let me say it the other way round more bluntly: Clean code does not mean the least amount of code possible to implement some runtime behavior! Just because you see more code than you think is technically needed, does not mean it’s smelling. The question always is: Why? Why more core than fore the bare functional necessity? And the answer has to show that future readers are kept in mind.</p><p></p><p></p><p>Yes, future readers over future requirements. It’s not that I don’t value future requirements on the right, but I find concern for future readers more important.</p><p></p><p></p><h3>Printing the statement</h3><p></p><p></p><p>Printing the statement is what the whole kata is about. It’s the crucial part and I want to get it right. Also I want to be able to work on it straightforwardly and independently.</p><p></p><p></p><p>If I wrote a test for just the <code>PrintStatement</code> function, though, I would need to open the <code>Account</code> class in order to gain control over its state; <code>PrintStatement</code> is relying on that.</p><p></p><p></p><p>To avoid this hassle I decide to switch to <a href="https://cumulative-hypotheses.org/2011/08/30/tdd-as-if-you-meant-it/" target="_blank" rel="noopener">TDD as if you meant it (TDDaiymi)</a> from Keith Braithwaite. That means I use tests as my sole development environment; I won’t touch the production code until I’ve finished the functionality.</p><p></p><p></p><p>Also I’ll be moving forward with incremental tests since I’m not really sure how to solve this problem.</p><p></p><p></p><h4>Iteration 1</h4><p></p><p></p><p>Here’s my first iteration: What should the statement look like if there are no transactions yet? It should be empty.</p><p></p><p></p><div class="wp-block-image"><figure class="aligncenter"><figure class="wp-image-2702"><img loading="lazy" src="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/DraggedImage-3-4.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-3-4-xs.png 300w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-3-4-sm.png 480w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-3-4-md.png 768w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-3-4-lg.png 1024w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-3-4-xl.png 1360w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-3-4-2xl.png 1600w" alt="" width="692" height="144"></figure></figure></div><p></p><p></p><p>I know this code looks pretty stupid. But it „simulates“ the situation in production: there are no transaction events (<code>new Account.Transaction[0]</code>). And the statement’s number of transactions mirrors that.</p><p></p><p></p><p>As simple as lines 13 and 14 might look, they are crucial and I expect them to stay the same in next test cases. They are like a seed to grow the solution from. There is a small insight encoded in them.</p><p></p><p></p><h4>Iteration 2</h4><p></p><p></p><p>The next incremental test is about just one transaction event. I set that up with fixed data in line 23:</p><p></p><p></p><div class="wp-block-image"><figure class="aligncenter"><figure class="wp-image-2705"><img loading="lazy" src="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/DraggedImage-4-3.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-4-3-xs.png 300w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-4-3-sm.png 480w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-4-3-md.png 768w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-4-3-lg.png 1024w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-4-3-xl.png 1360w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-4-3-2xl.png 1600w" alt="" width="876" height="233"></figure></figure></div><p></p><p></p><p>Line 24 is the same as 13 in the first test. But it’s followed by a manual mapping of the transaction event to the statement transaction.</p><p></p><p></p><p>Line 28 is the only noteworthy line here: It could be reduced to <code>accountTransactions[0].Amount</code>, but by including <code>0 +</code> I make clear right away that I know the transaction’s <code>Balance</code> is an accumulating value.</p><p></p><p></p><h4>Iteration 3</h4><p></p><p></p><p>When doing TDDaiymi I actually often create new test cases by copying previous test cases and only change the expectation first. That way it’s immediately red and I’m forced to solve the problem: adjust the test input data, then adapt the logic. This is what I’m doing for iteration 3, too.</p><p></p><p></p><p>Now it’s two transaction events to „print“. The expectations (58ff) and input data (40ff) are set up accordingly. Line 45 and 56 still match 13 and 14 of the first iteration as expected.</p><p></p><p></p><div class="wp-block-image"><figure class="aligncenter"><figure class="wp-image-2701"><img loading="lazy" src="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/DraggedImage-5-3.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-5-3-xs.png 300w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-5-3-sm.png 480w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-5-3-md.png 768w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-5-3-lg.png 1024w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-5-3-xl.png 1360w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-5-3-2xl.png 1600w" alt="" width="787" height="447"></figure></figure></div><p></p><p></p><p>And in between I copy the mapping from the previous test and adapt the second copy by changing the indexes.</p><p></p><p></p><p>Plus I need to think about how to carry over the balance from the previous statement transaction (line 54).</p><p></p><p></p><h4>Refactoring 1</h4><p></p><p></p><p>My impression is I’ve solved the statement printing problem. I know how it’s gonna work. Now I just need to generalize it. Currently the number of transaction events is hardcoded. This is along the lines of the <a href="https://blog.cleancoder.com/uncle-bob/2013/05/27/TheTransformationPriorityPremise.html" target="_blank" rel="noopener">Transformation Priority Premise</a>, I guess: <em>(constant-&gt;scalar)</em> and <em>(statement-&gt;recursion)</em>.</p><p></p><p></p><p>I refactor the hardcoded solution to a variable solution:</p><p></p><p></p><div class="wp-block-image"><figure class="aligncenter"><figure class="wp-image-2704"><img loading="lazy" src="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/DraggedImage-6-3.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-6-3-xs.png 300w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-6-3-sm.png 480w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-6-3-md.png 768w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-6-3-lg.png 1024w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-6-3-xl.png 1360w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-6-3-2xl.png 1600w" alt="" width="769" height="434"></figure></figure></div><p></p><p></p><p>The basic mapping stays the same (lines 50 to 54), but I move the balance update up because I want to use a variable for it (line 49).</p><p></p><p></p><p>The loop around the mapping is trivial: for each transaction event a statement transaction is created. The same as before, just automatically done.</p><p></p><p></p><h4>Refactoring 2</h4><p></p><p></p><p>With the refactored/generalized logic still getting the test to green I extract it to the production code. I’m confident it will work there, too:</p><p></p><p></p><div class="wp-block-image"><figure class="aligncenter"><figure class="wp-image-2699"><img loading="lazy" src="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/DraggedImage-7-3.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-7-3-xs.png 300w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-7-3-sm.png 480w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-7-3-md.png 768w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-7-3-lg.png 1024w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-7-3-xl.png 1360w, https://ralfw.github.io/homepage-ralfw-de/media/posts/135/responsive/DraggedImage-7-3-2xl.png 1600w" alt="" width="618" height="246"></figure></figure></div><p></p><p></p><p>The only adjustment I need to make is changing the source of the transaction events to the <code>Account</code> class’ global state <code>_transactions</code>.</p><p></p><p></p><p>With <code>PrintStatement</code> filled in I check the acceptance test. It should be green now - if the implementation of the transaction functions was correct.</p><p></p><p></p><p>And indeed it is!&#x1f389;</p><p></p><p></p><p>Problem solved.&#x1f60e;&#x1f57a;</p><p></p><p></p><h2>Refactoring</h2><p></p><p></p><p>What’s left is to restrict the accessibility of functions and classes to <code>private</code> where necessary. The surface of the production code should be minimal.</p><p></p><p></p><p>That’s only affecting the <code>Account.Transaction</code> class which I set to <code>internal</code> while going through the TDDaiymi iterations.</p><p></p><p></p><p>Now that it’s hidden, however, the TDDaiymi test becomes flagged. The incremental tests cannot be compiled anymore. Their true nature is revealed: they were <a href="https://ralfw.de/2019/07/hamburg-style-tdd-diamond-kata/" target="_blank" rel="noopener"><em>scaffolding tests</em></a> all along. That means they now have to be deleted.</p><p></p><p></p><p>The acceptance test remains as the only test. That makes me free to refactor the solution below the surface at any time without breaking tests targeting details.</p><p></p><p></p><h2>Summary</h2><p></p><p></p><p>This problem required a somewhat different treatment compared to the Diamond kata: not writing tests for functions, doing TDDaiymi… That might feel new or uncomfortable to you. But I stand by my opinion: it’s legitimate, it’s even easier than sticking to one of the other schools of TDD.</p><p></p><p></p><p>In the end it’s all about the result. How straightforwardly can you move towards functional and clean code? If ADC and TBC can help, then you should employ them.</p><p></p><p></p><p>But Hamburg style TDD actually is not in opposition of Chicago style etc. Rather it’s embracing them all - and adding a twist. This twist is the recommendation to do explicit analysis and explicit design and to avoid functional dependencies. And that in turn leads to tests with no (or less) need for substitutes, i.e. less complexity.</p><p></p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on 25.01.2021</p><ul class="post__tag"><li><a href="https://ralfw.github.io/homepage-ralfw-de/tags/tdd/">TDD</a></li></ul><div class="post__share"></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://ralfw.github.io/homepage-ralfw-de/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://ralfw.github.io/homepage-ralfw-de/co-creation-at-work/" class="invert post__nav-link" rel="prev"><span>Previous</span> Co-creation at work</a></div><div class="post__nav-next"><a href="https://ralfw.github.io/homepage-ralfw-de/ueber-den-fundamentalen-zielkonflikt-in-unternehmen-und-in-der-schule/" class="invert post__nav-link" rel="next"><span>Next</span> Über den fundamentalen Zielkonflikt in Unternehmen - und in der Schule </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://ralfw.github.io/homepage-ralfw-de/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav></main><footer class="footer"><div class="footer__copyright"><p>One Man Think Tank EOOD - Sofia, Bulgaria - <a href="../../../../../../imprint">Imprint</a> - <a href="../../../../../../data-privacy-policy">Data Privacy Policy</a></p></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://ralfw.github.io/homepage-ralfw-de/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://ralfw.github.io/homepage-ralfw-de/assets/js/scripts.min.js?v=f4c4d35432d0e17d212f2fae4e0f8247"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>