<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Event Sourcing Challenge: Bowling Game Kata - ralfw-de</title><meta name="description" content=" Event Sourcing ist fÃ¼r mich die Zukunft der grundsÃ¤tzlichen Zustandshaltung in Software. Alles andere ist eine Optimierung, die man nicht leichtfertig und schon gar nicht vorzeitig vornehmen sollte. Mit Event Sourcing verdrÃ¤ngt endlich Konstruktivismus den bisherigen Materialismus des immer noch dominierenden RDBMS/OO-Denkens.1 Und ich&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://ralfw.de/event-sourcing-challenge-bowling-game-kata/"><link rel="alternate" type="application/atom+xml" href="https://ralfw.de/feed.xml"><link rel="alternate" type="application/json" href="https://ralfw.de/feed.json"><meta property="og:title" content="Event Sourcing Challenge: Bowling Game Kata"><meta property="og:image" content="https://ralfw.de/media/posts/138/DraggedImage-3.png"><meta property="og:site_name" content="ralfw-de"><meta property="og:description" content=" Event Sourcing ist fÃ¼r mich die Zukunft der grundsÃ¤tzlichen Zustandshaltung in Software. Alles andere ist eine Optimierung, die man nicht leichtfertig und schon gar nicht vorzeitig vornehmen sollte. Mit Event Sourcing verdrÃ¤ngt endlich Konstruktivismus den bisherigen Materialismus des immer noch dominierenden RDBMS/OO-Denkens.1 Und ich&hellip;"><meta property="og:url" content="https://ralfw.de/event-sourcing-challenge-bowling-game-kata/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@ralfw"><meta name="twitter:title" content="Event Sourcing Challenge: Bowling Game Kata"><meta name="twitter:description" content=" Event Sourcing ist fÃ¼r mich die Zukunft der grundsÃ¤tzlichen Zustandshaltung in Software. Alles andere ist eine Optimierung, die man nicht leichtfertig und schon gar nicht vorzeitig vornehmen sollte. Mit Event Sourcing verdrÃ¤ngt endlich Konstruktivismus den bisherigen Materialismus des immer noch dominierenden RDBMS/OO-Denkens.1 Und ich&hellip;"><meta name="twitter:image" content="https://ralfw.de/media/posts/138/DraggedImage-3.png"><link rel="shortcut icon" href="https://ralfw.de/media/website/favicon.png" type="image/x-icon"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--logo-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--menu-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://ralfw.de/assets/css/style.css?v=0173fa4178744f44e30f72c6ec93483a"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://ralfw.de/event-sourcing-challenge-bowling-game-kata/"},"headline":"Event Sourcing Challenge: Bowling Game Kata","datePublished":"2019-12-17T12:44","dateModified":"2021-01-27T17:40","image":{"@type":"ImageObject","url":"https://ralfw.de/media/posts/138/DraggedImage-3.png","height":480,"width":576},"description":" Event Sourcing ist fÃ¼r mich die Zukunft der grundsÃ¤tzlichen Zustandshaltung in Software. Alles andere ist eine Optimierung, die man nicht leichtfertig und schon gar nicht vorzeitig vornehmen sollte. Mit Event Sourcing verdrÃ¤ngt endlich Konstruktivismus den bisherigen Materialismus des immer noch dominierenden RDBMS/OO-Denkens.1 Und ich&hellip;","author":{"@type":"Person","name":"Ralf Westphal"},"publisher":{"@type":"Organization","name":"Ralf Westphal","logo":{"@type":"ImageObject","url":"https://ralfw.de/media/website/logo-smaller.png","height":53,"width":250}}}</script></head><body><script type="text/javascript">var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/606e06a2f7ce1827093813ae/1f2msm5ed';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();</script><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://ralfw.de/"><img src="https://ralfw.de/media/website/logo-smaller.png" alt="ralfw-de"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://ralfw.de/focus/" target="_self">Focus</a></li><li><a href="https://ralfw.de/approach/" target="_self">Approach</a></li><li class="has-submenu"><a href="https://ralfw.de/trainings/" target="_self" aria-haspopup="true">Trainings</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://ralfw.de/test-first-codierung/" target="_self">Test-first CodierungğŸ‡©ğŸ‡ª</a></li><li><a href="https://ralfw.de/softwareentwurf-mit-flow-design/" target="_self">Softwareentwurf mit Flow-DesignğŸ‡©ğŸ‡ª</a></li><li><a href="https://ralfw.de/software-anforderungsanalyse-mit-slicing/" target="_self">Software Anforderungsanalyse mit SlicingğŸ‡©ğŸ‡ª</a></li></ul></li><li><a href="https://ralfw.de/consulting/" target="_self">Consulting</a></li><li><a href="https://ralfw.de/publications/" target="_self">Publications</a></li><li><a href="https://ralfw.de/testimonials/" target="_self">Testimonials</a></li><li class="has-submenu"><a href="https://ralfw.de/" target="_self" aria-haspopup="true">BlogsğŸ‡©ğŸ‡ªğŸ‡¬ğŸ‡§</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://ralfw.de/" target="_self">2015.. ğŸ‡©ğŸ‡ªğŸ‡¬ğŸ‡§</a></li><li><a href="https://blog.ralfw.de/" target="_blank">ğŸŒ2007..2015ğŸ‡©ğŸ‡ª</a></li><li><a href="http://geekswithblogs.net/theArchitectsNapkin/Default.aspx" target="_blank">ğŸŒ2008..2015ğŸ‡¬ğŸ‡§</a></li><li><a href="https://weblogs.asp.net/ralfw" target="_blank">ğŸŒ2003..2010ğŸ‡¬ğŸ‡§</a></li><li><span class="is-separator">â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></li><li><a href="http://soziokratie.ralfw.de/" target="_blank">ğŸŒZur SoziokratieğŸ‡©ğŸ‡ª</a></li><li><a href="https://medium.com/gedankliche-umtriebe" target="_blank">ğŸŒGedankliche UmtriebeğŸ‡©ğŸ‡ª</a></li><li><a href="https://medium.com/personal-flow" target="_blank">ğŸŒPersonal FlowğŸ‡©ğŸ‡ª</a></li></ul></li><li><a href="https://ralfw.de/about/" target="_self">About</a></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><form action="https://ralfw.de/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" placeholder="search..." aria-label="search..." autofocus="autofocus"></form><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://ralfw.de/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://ralfw.de/media/posts/138/DraggedImage-3.png" srcset="https://ralfw.de/media/posts/138/responsive/DraggedImage-3-xs.png 300w, https://ralfw.de/media/posts/138/responsive/DraggedImage-3-sm.png 480w, https://ralfw.de/media/posts/138/responsive/DraggedImage-3-md.png 768w, https://ralfw.de/media/posts/138/responsive/DraggedImage-3-lg.png 1024w, https://ralfw.de/media/posts/138/responsive/DraggedImage-3-xl.png 1360w, https://ralfw.de/media/posts/138/responsive/DraggedImage-3-2xl.png 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="480" width="576" alt=""></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2019-12-17T12:44">17.12.2019</time></div><h1>Event Sourcing Challenge: Bowling Game Kata</h1><div class="post__meta post__meta--author"><a href="https://ralfw.de/authors/ralf-westphal/" class="feed__author invert">Ralf Westphal</a></div></div></header></div><div class="wrapper post__entry"><p></p><p>Event Sourcing ist fÃ¼r mich die Zukunft der grundsÃ¤tzlichen Zustandshaltung in Software. Alles andere ist eine Optimierung, die man nicht leichtfertig und schon gar nicht vorzeitig vornehmen sollte.</p><p></p><p></p><p>Mit Event Sourcing verdrÃ¤ngt endlich <a href="#INTERNAL_LINK#/post/NaN">Konstruktivismus</a> den bisherigen Materialismus des immer noch dominierenden RDBMS/OO-Denkens.<sup><a id="ffn1" class="footnote" href="#fn1">1</a></sup> Und ich halte Event Sourcing fÃ¼r die Grundlage von AntifragilitÃ¤t in der Softwareentwicklung.<sup><a id="ffn2" class="footnote" href="#fn2">2</a></sup></p><p></p><p></p><p>Ich finde Event Sourcing also sehr spannend und wichtig â€“ nur leicht ist es nicht. Denn auch wenn Event Sourcing auf das eine Datenmodell, die eine groÃŸe Datenstruktur verzichtet, bedeutet das nicht, dass man sich keine Gedanken um Datenmodelle machen muss.</p><p></p><p></p><p>Damit meine ich nicht die vielen situationsspezifischen Strukturen, die nun sehr einfach mÃ¶glich werden. FÃ¼r jede Interaktion mit einer Software kann es nun ein daraufhin optimiertes Datenmodell geben.</p><p></p><p></p><p>Ich meine die Events, die beim Event Sourcing in einem stetig wachsenden Strom gespeichert werden und den sich entwickelnden Systemzustand reprÃ¤sentieren. Statt des einen groÃŸen Datenmodells gibt es im Event Sourcing ein Granulat bestehend aus kleinen und kleinsten Datenstrukturen, den Events.</p><p></p><p></p><p>Das ist fÃ¼r das RDBMS- oder auch Dokumenten-gewohnte Denken eine Umstellung. WÃ¤hrend man bisher versuchen konnte, â€die Struktur der Weltâ€œ zu erkennen und mÃ¶glichst realitÃ¤tsgetreu in Software abzubilden, geht es jetzt um ihre Entfaltung Ã¼ber die Zeit. Es geht nicht mehr um statische Resultate von letztlich irrelevanten Ereignissen, sondern um hÃ¶chst relevante Ereignisse, aus denen alle mÃ¶glichen Resultate in Zukunft abgeleitet werden kÃ¶nnen.</p><p></p><p></p><p>Die Welt der Zustandshaltung steht damit Kopf, wÃ¼rde ich sagen.ğŸ™ƒğŸ˜</p><p></p><p></p><p>Gedanken muss man sich also beim Event Sourcing um die Events machen. Klingt auch ohne groÃŸe Einleitungsworte plausible, oder?ğŸ˜‰</p><p></p><p></p><p>Wie findet man aber â€die bestenâ€œ Events? Was sind Ã¼berhaupt â€guteâ€œ Events? Das sind Fragen, die mich deshalb bewegen. Ich suche Prinzipien und Heuristiken, um fÃ¼r gegebenen Anforderungen mindestens â€ziemlich guteâ€œ Events zu finden.</p><p></p><p></p><h2>Die Challenge</h2><p></p><p></p><p>Deshalb habe ich im Domain Driven Design Slack-Workspace â€DDD Germanyâ€œ mal nachgefragt, wie man dort die Sache sieht. Getan habe ich das mit einer kleinen Aufgabe, die mir einerseits sehr Ã¼berschaubar scheint, andererseits aber doch ein bisschen Herausforderung bietet.<sup><a id="ffn3" class="footnote" href="#fn3">3</a></sup></p><p></p><p></p><p><a href="https://paper.dropbox.com/doc/EventSourcing-Challenge-Die-Bowling-Game-Kata--AqiYiJ05NEjMjfC6iUSFxU2lAg-MrmZs8ODudTrrlrvSi5i0" target="_blank" rel="noopener">Als Aufgabe</a> habe ich die aus Coding Dojos bekannte Bowling Game Kata gewÃ¤hlt:</p><p></p><p></p><div class="wp-block-image"><figure class="aligncenter"><figure class="alignnone wp-image-2773"><img loading="lazy" src="https://ralfw.de/media/posts/138/DraggedImage.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://ralfw.de/media/posts/138/responsive/DraggedImage-xs.png 300w, https://ralfw.de/media/posts/138/responsive/DraggedImage-sm.png 480w, https://ralfw.de/media/posts/138/responsive/DraggedImage-md.png 768w, https://ralfw.de/media/posts/138/responsive/DraggedImage-lg.png 1024w, https://ralfw.de/media/posts/138/responsive/DraggedImage-xl.png 1360w, https://ralfw.de/media/posts/138/responsive/DraggedImage-2xl.png 1600w" alt="" width="548" height="1244"></figure></figure></div><p></p><p></p><p>Es soll ein â€ErgebniszÃ¤hlerâ€œ realisiert werden, der die Punktzahl eines Bowling-Spiels bestimmt. Dieser ZÃ¤hler reagiert auf zwei CQS-Nachrichten: dass ein Wurf registriert und dass das Ergebnis geliefert werden soll. Mehr nicht.</p><p></p><p></p><p>Es gibt also zwei glasklare Interaktionen der Umwelt mit einer ZÃ¤hler-Software. DarÃ¼ber muss nicht spekuliert werden. Die einzige Frage, die die Aufgabe stellt, ist die nach den Events.</p><p></p><p></p><p>Die Interaktionen basieren auf gemeinsamem Zustand. Dieser Zustand soll mit Event Sourcing realisiert gedacht werden, d.h. als Strom von Events. Welche Events sollten das sein?</p><p></p><p></p><p>Mehr ist nicht zu liefern, nur die Events. Die LÃ¶sung soll gerade nicht komplett implementiert werden, weil es mir ja darum geht, wie Events <em>a priori</em> gefunden werden kÃ¶nnen.</p><p></p><p></p><p>Event Storming - nomen es omen - ist eine Technik, die dafÃ¼r zum Einsatz kommen kÃ¶nnte; allerdings sehe ich sie vor allem bei Szenarien, die deutlich grÃ¶ÃŸer sind und/oder bei denen es viele Sichtweisen zu berÃ¼cksichtigen gilt.<sup><a id="ffn4" class="footnote" href="#fn4">4</a></sup></p><p></p><p></p><p>Dass man nach Implementation und Betrieb einer LÃ¶sung immer schlauer ist und also vielleicht auch eine noch bessere Idee hat, welche Events nÃ¼tzlich wÃ¤ren, scheint mir ausgemacht. Wie bei RDBMS oder umfÃ¤nglichen Objektmodellen ist eine Ã„nderung der Datenbasis dann jedoch schwierig. Und Event Sourcing verspricht ja, dass man gerade das nicht tun muss/soll.</p><p></p><p></p><p>Events versionieren, weitere Events spÃ¤ter nachschieben, einen Eventstrom komplett umschreiben: das kann man alles machen und es mag zuzeiten nÃ¶tig sein. Doch so, wie es einige Kriterien fÃ¼r RDBMS-Schemata gibt, um nicht gleich mit dem falschen FuÃŸ aufzustehen, so gibt es ja vielleicht auch Kriterien fÃ¼r das Schneiden von Events, um den Zeitpunkt hinauszuzÃ¶gern, da man sich in eine Ecke gepinselt hat. Was meint die DDD-Community dazu?</p><p></p><p></p><h2>Die LÃ¶sungen</h2><p></p><p></p><p>Ich hatte zuerst fÃ¼r mich selbst die Aufgabe gelÃ¶st (und natÃ¼rlich doch nicht darauf verzichtet, den kompletten Code dafÃ¼r zu schreibenğŸ¤ª). Ohne meine Events zu verraten, habe ich dann die Aufgabe der Community vorgelegt und weitere vier LÃ¶sungen bekommen.</p><p></p><p></p><p>Ich liste sie einfach mal mit den Slack-Benutzernamen ihrer Einreicher in alphabetischer Reihenfolge:</p><p></p><p></p><div class="wp-block-image"><figure class="aligncenter"><figure class="wp-image-2772"><img loading="lazy" src="https://ralfw.de/media/posts/138/DraggedImage-1.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://ralfw.de/media/posts/138/responsive/DraggedImage-1-xs.png 300w, https://ralfw.de/media/posts/138/responsive/DraggedImage-1-sm.png 480w, https://ralfw.de/media/posts/138/responsive/DraggedImage-1-md.png 768w, https://ralfw.de/media/posts/138/responsive/DraggedImage-1-lg.png 1024w, https://ralfw.de/media/posts/138/responsive/DraggedImage-1-xl.png 1360w, https://ralfw.de/media/posts/138/responsive/DraggedImage-1-2xl.png 1600w" alt="LÃ¶sung von @akii" width="241" height="79"></figure><figcaption>LÃ¶sung von @akii</figcaption></figure></div><p></p><p></p><div class="wp-block-image"><figure class="aligncenter"><figure class="wp-image-2774"><img loading="lazy" src="https://ralfw.de/media/posts/138/DraggedImage-2.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://ralfw.de/media/posts/138/responsive/DraggedImage-2-xs.png 300w, https://ralfw.de/media/posts/138/responsive/DraggedImage-2-sm.png 480w, https://ralfw.de/media/posts/138/responsive/DraggedImage-2-md.png 768w, https://ralfw.de/media/posts/138/responsive/DraggedImage-2-lg.png 1024w, https://ralfw.de/media/posts/138/responsive/DraggedImage-2-xl.png 1360w, https://ralfw.de/media/posts/138/responsive/DraggedImage-2-2xl.png 1600w" alt="LÃ¶sung von @bwaidelich" width="273" height="77"></figure><figcaption>LÃ¶sung von @bwaidelich</figcaption></figure></div><p></p><p></p><div class="wp-block-image"><figure class="aligncenter"><figure class="wp-image-2769"><img loading="lazy" src="https://ralfw.de/media/posts/138/DraggedImage-3.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://ralfw.de/media/posts/138/responsive/DraggedImage-3-xs.png 300w, https://ralfw.de/media/posts/138/responsive/DraggedImage-3-sm.png 480w, https://ralfw.de/media/posts/138/responsive/DraggedImage-3-md.png 768w, https://ralfw.de/media/posts/138/responsive/DraggedImage-3-lg.png 1024w, https://ralfw.de/media/posts/138/responsive/DraggedImage-3-xl.png 1360w, https://ralfw.de/media/posts/138/responsive/DraggedImage-3-2xl.png 1600w" alt="LÃ¶sung von @phj" width="405" height="338"></figure><figcaption>LÃ¶sung von @phj</figcaption></figure></div><p></p><p></p><div class="wp-block-image"><figure class="aligncenter"><figure class="wp-image-2770"><img loading="lazy" src="https://ralfw.de/media/posts/138/DraggedImage-4.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://ralfw.de/media/posts/138/responsive/DraggedImage-4-xs.png 300w, https://ralfw.de/media/posts/138/responsive/DraggedImage-4-sm.png 480w, https://ralfw.de/media/posts/138/responsive/DraggedImage-4-md.png 768w, https://ralfw.de/media/posts/138/responsive/DraggedImage-4-lg.png 1024w, https://ralfw.de/media/posts/138/responsive/DraggedImage-4-xl.png 1360w, https://ralfw.de/media/posts/138/responsive/DraggedImage-4-2xl.png 1600w" alt="Meine eigene LÃ¶sung (@ralfw)" width="443" height="396"></figure><figcaption>Meine eigene LÃ¶sung (@ralfw)</figcaption></figure></div><p></p><p></p><div class="wp-block-image"><figure class="aligncenter"><figure class="wp-image-2771"><img loading="lazy" src="https://ralfw.de/media/posts/138/DraggedImage-5.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://ralfw.de/media/posts/138/responsive/DraggedImage-5-xs.png 300w, https://ralfw.de/media/posts/138/responsive/DraggedImage-5-sm.png 480w, https://ralfw.de/media/posts/138/responsive/DraggedImage-5-md.png 768w, https://ralfw.de/media/posts/138/responsive/DraggedImage-5-lg.png 1024w, https://ralfw.de/media/posts/138/responsive/DraggedImage-5-xl.png 1360w, https://ralfw.de/media/posts/138/responsive/DraggedImage-5-2xl.png 1600w" alt="LÃ¶sung von @sebastian" width="231" height="211"></figure><figcaption>LÃ¶sung von @sebastian</figcaption></figure></div><p></p><p></p><p>Die LÃ¶sungen wurden in Pseudocode, Typescript, C#, F# eingereicht. Ich habe sie zur besseren Vergleichbarkeit alle nach C# Ã¼bersetzt. Ein bisschen ging dabei die AusdrucksfÃ¤higkeit von F# (@phj) verloren, aber das finde ich nicht schlimm.</p><p></p><p></p><p>AuÃŸerdem habe ich sie insofern vereinheitlicht, als dass ich eine Game ID, die in manchen LÃ¶sungen in den Events stand, gelÃ¶scht habe. Ich denke, sie trÃ¤gt in Bezug auf diese Aufgabe nichts zur Erkenntnis von Prinzipien und Heuristiken bei und betrifft einen orthogonalen Belang.</p><p></p><p></p><h3>LÃ¶sungsebenen</h3><p></p><p></p><p>Die Aufgabe war nicht groÃŸ. Die LÃ¶sungsvorschlÃ¤ge sollten also nicht so weit auseinander liegen. So hatte ich es mir gedacht - und war dann doch Ã¼berrascht, dass selbst hier eine LÃ¶sungsvielfalt entstanden ist.</p><p></p><p></p><p>Ich sehe die LÃ¶sungen auf drei Ebenen:</p><p></p><p></p><ol><li>MinimallÃ¶sung (@akii, @bwaidelich): Es wird nur ein Event benÃ¶tigt, der die Ã¼ber das Kommando gemeldeten geworfenen Pins aufzeichnet.</li><li>Aufzeichnung von Bonuspunkten (@sebastian): ZusÃ¤tzlich zum Event der MinimallÃ¶sung wird aufgezeichnet, dass ein Wurf als Bonus fÃ¼r einen vorhergehenden anerkannt wurde.</li><li>Aufzeichnung von Frames und BonuswÃ¼rdigkeit (@phj, @ralfw): ZusÃ¤tzlich zu den Events der zweiten Ebene wird aufgezeichnet, falls ein Wurf einen Frame beendet hat und ob der Frame bonuswÃ¼rdig ist (Spare oder Strike).</li></ol><p></p><p></p><h3>Analyse</h3><p></p><p></p><p>Die Idee hinter der Aufgabe war, dass ein Event Store befÃ¼llt wird mit Events im Rahmen der Verarbeitung des einen Kommandos - und dass die Events wÃ¤hrend der einen Query zu einem Gesamtergebnis verarbeitet werden.</p><p></p><p></p><p>Die Logik zur Herstellung des Verhaltens wÃ¼rde sich in einer Implementation also auf einen Command- und einen Query-Handler verteilen. Die Wahl der Events hat darauf einen groÃŸen Einfluss.</p><p></p><p></p><p>Die MinimallÃ¶sungen zeichnen im Grunde nur die mit dem Kommando gemeldeten Pins eines Wurfes 1:1 auf. Das ist trivial, so dass die ganze Last der Ergebnisberechnung bei der Query-Verarbeitung liegt. Die MinimallÃ¶sungen betreiben mithin eigentlich kein Event Sourcing, sondern eher ein Command Sourcing.</p><p></p><p></p><p>Die BonuspunktlÃ¶sung verschiebt die Last zum Command-Handling. Bei der Query-Verarbeitung mÃ¼ssen nur die Pins aus den Events fÃ¼r die WÃ¼rfe und die Bonuspunkte addiert werden. Das ist trivial - dafÃ¼r muss die Kommando-Verarbeitung allerdings vorher entschieden haben, wann ein Bonuspunkt-Event aufzuzeichnen ist.</p><p></p><p></p><p>Die Frame-/BonuswÃ¼rdigkeit-LÃ¶sungen vereinfachen die Logik der Query-Verarbeitung nicht weiter; die bleibt trivial. Die zusÃ¤tzlichen Events wirken sich vielmehr auf das Command-Handling differenzierend aus. Vielleicht wÃ¤chst die Logik dort noch ein wenig, vor allem scheint es mir aber einfacher, in der Kommando-Verarbeitung Verantwortlichkeiten zu trennen: festzustellen, ob/ab wann ein Bonus gewÃ¤hrt wird, und einen Bonus zuzuweisen, sind eben zwei verschiedene Aufgaben.</p><p></p><p></p><p>Interessant finde ich, dass keine LÃ¶sung einen Event zur Anzeige eines Spielendes definiert.<sup><a id="ffn5" class="footnote" href="#fn5">5</a></sup> Ist das kein AufzeichnungswÃ¼rdiges Ereignis? Oder war die Aufgabe so formuliert, dass alle angenommen haben, dass am Spielende der Eventstrom verschwindet? Dagegen spricht, dass einige LÃ¶sungen auch die Aufzeichnung einer Game ID vorgeschlagen haben. Da wurde augenscheinlich grÃ¶ÃŸer gedacht.</p><p></p><p></p><p>Oder war die Aufgabe unterspezifiziert insofern, als dass nicht angegeben war, was passieren soll, wenn ein Wurf Ã¼ber die maximale Wurfzahl eines Spiels hinaus gemeldet wird? Damit war sozusagen das Spielende kein Thema in der Aufgabenbeschreibung? Hmâ€¦ğŸ¤”</p><p></p><p></p><h3>Diskussion</h3><p></p><p></p><p>Was tun mit einem Spektrum an LÃ¶sungen? Sind sie alle gleichwertig, gleich gut? Welches FÃ¼r und Wider gibt es? Genau um diese Erkenntnis ging es mir ja, als ich die Aufgabe gestellt habe.</p><p></p><p></p><p>AugenfÃ¤llig ist zunÃ¤chst der Unterschied zwischen den MinimallÃ¶sungen und den anderen in der Verortung der Logik. Die MinimallÃ¶sungen brauchen gewiss viel Logik wÃ¤hrend des Query-Handlings - wie viel sie im Command-Handling tun, ist eine Frage des Anspruchs an Validation/KonsistenzprÃ¼fung. Im einfachsten Fall ist dort im Grunde gar keine Logik nÃ¶tig.</p><p></p><p></p><p>Das Argument der Vertreter dieses Ansatzes ist sehr simpel: â€Ein Event reicht.â€œ Und das ist wahr. Aufzuzeichnen, dass ein Wurf gemacht wurde bedeutet, ein reales Ereignis in der Umwelt aufzuzeichnen. Das wird Ã¼ber ein Kommando gemeldet und ist die einzige Anweisung zur ZustandsÃ¤nderung. Wenn man sich das merkt, kann der Rest jederzeit daraus abgeleitet werden.</p><p></p><p></p><p>Wenn es so einfach funktioniert, warum sind dann aber 60% der Einreicher auf weitere Events gekommen? Ich denke, das liegt an der AbhÃ¤ngigkeit, die mit der MinimallÃ¶sung einhergeht: Ein bei der Query nach auÃŸen gemeldeter Zustand ist vollstÃ¤ndig abhÃ¤ngig von Logik. Ã„ndern sich z.B. die Regeln, kÃ¶nnen die Ergebnisse alter Spiele u.U. nicht mehr nachvollzogen werden.</p><p></p><p></p><p>Das mag ok sein, wenn eine solche Ã„nderung nicht zu erwarten ist, weil die DomÃ¤ne sehr stabil ist. Oder es mag ok sein fÃ¼r ein so kleines Beispiel mit angenommener Kurzlebigkeit. FÃ¼r â€richtigeâ€œ Software jedoch scheint mir da eine Gefahr fehlender Reproduzierbarkeit zu liegen.</p><p></p><p></p><p>Event Sourcing LÃ¶sungen sind mehr von Logik abhÃ¤ngig als LÃ¶sungen, die Zustand in einem dauerhaften Modell aktuell halten, weil stÃ¤ndig Projektionen von Events auf temporÃ¤re, grundsÃ¤tzlich flÃ¼chtige Modelle stattfinden. Deshalb wÃ¼rde ich mich nicht auf nur den einen minimal notwendigen Event verlassen wollen.</p><p></p><p></p><p>Wie viele Events mehr sollen es dann aber sein?</p><p></p><p></p><p>Events reprÃ¤sentieren Weggabelungen in der Entwicklung der Welt. Wenn etwas passiert, dann kollabiert ein MÃ¶glichkeitsraum; ein Weg ist eingeschlagen worden. Vor dem ersten Wurf ist es noch mÃ¶glich, dass nach dem Wurf 10, 9, â€¦, 1, 0 Pins abgerÃ¤umt sein werden; nach dem Wurf ist klar, dass genau z.B. 4 Pins abgerÃ¤umt wurden.</p><p></p><p></p><p>Dasselbe ist der Fall bei Entscheidungen: Sie lassen einen MÃ¶glichkeitsraum zusammenschnurren auf genau eine MÃ¶glichkeit, nÃ¤mlich die, fÃ¼r die sich entschieden wurde. Vor einer Entscheidung ist es noch mÃ¶glich, dass z.B. beim Sturz eines FuÃŸballspielers nach ZusammenstoÃŸ mit einem anderen ein Fowl gepfiffen wird oder nicht. Der Schiedsrichter kann sich fÃ¼r oder gegen Fowl entscheiden und er kann sich sogar fÃ¼r ein Fowl mit oder ohne Vorteil entscheiden (wenn ich es recht erinnere). Mit der Entscheidung des Schiedsrichters erst schnurrt der MÃ¶glichkeitsraum zusammen auf genau ein Urteil; was passiert ist, ist dann ganz klar z.B. ein Fowl gewesen.</p><p></p><p></p><p>Entscheidungen lassen nichts direkt passieren. Vielmehr deuten sie etwas, das passiert ist - und lassen als Ergebnis wieder etwas passieren. Ein Urteil, eine Entscheidung ist ebenfalls ein Ereignis. Mit jeder Entscheidung verÃ¤ndert sich der Weg eines Systems, d.h. sein Zustand. Wer sich nach links wendet, ist in einem anderen Zustand, als hÃ¤tte er sich nach rechts gewendet.</p><p></p><p></p><p>Die Aufzeichnung des per Kommando gemeldeten Pins betrifft also quasi ein Ereignis 1. Ordnung, ein unmittelbares Ereignis. Das Programm â€erleidetâ€œ dieses Ereignis, es kann nichts dafÃ¼r.</p><p></p><p></p><p>Die Einreicher von LÃ¶sungen oberhalb der MinimallÃ¶sung haben sich nun Ã¼berlegt, dass es hilfreich wÃ¤re, weitere Ereignisse aufzuzeichnen. Die nenne ich mal Ereignisse 2. und hÃ¶herer Ordnung. Sie reprÃ¤sentieren Entscheidungen der Spiellogik.</p><p></p><p></p><p>Bei @sebastian wird nur festgehalten, dass die Logik im Command-Handling erkannt hat, dass ein Wurf als Bonus fÃ¼r einen vorhergehenden Frame zu zÃ¤hlen ist. Das reicht aus, um die Query-Logik drastisch zu vereinfachen.</p><p></p><p></p><p>Die AngriffsflÃ¤che von RegelÃ¤nderungen auf die Berechnung eines Spielergebnisses ist damit deutlich kleiner geworden, wÃ¼rde ich sagen. Es muss zwar immer noch summiert werden, doch das liegt auf der Hand, wÃ¼rde ich sagen. Nur ein Spielende-Ereignis, in dem man das Ergebnis festschreibt, wÃ¼rde noch mehr Robustheit gegenÃ¼ber RegelÃ¤nderungen versprechen.</p><p></p><p></p><p>Und was ist mit den darÃ¼ber hinaus gehenden Events der LÃ¶sungen von @phj und @ralfw? Sie dokumentieren auch Entscheidungen; oder ich kÃ¶nnte es auch Erkenntnisse nennen. Die Logik entscheidet, dass mit einem Wurf ein Frame abgeschlossen wurde. Die Logik erkennt den Abschluss eines Frame.</p><p></p><p></p><p>Warum diese Entscheidungen auch noch aufzeichnen? Die Ergebnisberechnung profitiert davon nicht mehr. Vielleicht wird es mit diesen Events aber einfacher, einen Bonuswurf zu erkennen? Das kÃ¶nnte sein. Dann wÃ¤ren es â€funktionaleâ€œ Events.</p><p></p><p></p><p>Oder dienen sie nur der Dokumentation von Entscheidungen, damit die dauerhaft nachvollziehbar und fÃ¼r zukÃ¼nftige Nachrichtenbehandlungen nÃ¼tzlich sind? Dann wÃ¤ren es zunÃ¤chst â€dokumentierendeâ€œ Events.</p><p></p><p></p><p>@phj hat sein Denken so erklÃ¤rt:</p><p></p><p></p><blockquote class="wp-block-quote"><p>[M]it nur â€œroll madeâ€ wÃ¤re ja nur eine nach events aussehende Fassade vor eine nicht wirklich event-orientierte LÃ¶sung gekommen. Das wichtige bei ES ist - und das habe ich versucht damit etwas herauszustellen - dass Logik nur in den Command Handlern, aber nicht in den Projektionen stattfindet. Die Entscheidungen, was ein Frame ist, wann ein Bonus erforderlich wird, etc. mussten damit vor dem VerÃ¶ffentlichen von Events geschehen, und erfordern daher dann auch spezifische Events.</p></blockquote><p></p><p></p><p>Etwas zugespitzt formuliert ist der fÃ¼r mich wesentliche Punkt: <em>â€dass [Entscheidungsl]ogik nur in Command Handlernâ€œ</em> steht.</p><p></p><p></p><p>@phj sagt weiter:</p><p></p><p></p><blockquote class="wp-block-quote"><p>dass in den Projektionen keine Entscheidungen [â€¦] getroffen werden dÃ¼rfen, [weil] die eventuell nicht dauerhaft in ihrer Struktur oder Parametrisierung sind. [â€¦] Ansonsten wÃ¼rde eine zukÃ¼nftige RegelÃ¤nderung zu einer nachtrÃ¤glich anderen Interpretation von bereits durchgefÃ¼hrten Spielen fÃ¼hren. Also mÃ¼ssen die Events die Struktur der Vorbedingungen und der Entscheidungsergebnisse der GeschÃ¤ftslogik festhalten</p></blockquote><p></p><p></p><p>Das deckt sich mit meinem VerstÃ¤ndnis; nicht umsonst sind wir auf sehr Ã¤hnliche LÃ¶sungen gekommenğŸ˜‰</p><p></p><p></p><h2>Ergebnis</h2><p></p><p></p><p>Events zu finden fÃ¼r gegebene Kommandos und Queries lÃ¤sst Raum fÃ¼r KreativitÃ¤t. Hier wie auch sonst in der Softwareentwicklung ist eine Balance zwischen dem unzweifelhaft jetzt Erkennbaren und dem mÃ¶glichen ZukÃ¼nftigen zu finden. Auch beim Schneiden von Events kann man ansonsten wohl vorzeitig optimieren.</p><p></p><p></p><p>Allerdings scheinen mir lieber mehr als weniger Events tendenziell eine relativ harmlose und billige Optimierung im Hinblick auf zukÃ¼nftige Nachvollziehbarkeit und Events als Ausgangsmaterial fÃ¼r weitere Nachrichtenverarbeitungen.</p><p></p><p></p><p>Sich beim einmaligen Schreiben etwas mehr MÃ¼he zu geben, erleichtert spÃ¤ter das hÃ¤ufige Lesen aus unterschiedlichen Blickwinkeln. Event Sourcing unterscheidet sich da nicht von der Programmierung, wÃ¼rde ich sagen.</p><p></p><p></p><p>Die Kunst des Event Sourcing besteht dann wohl darin, schon aus den Anforderungen die wesentlichen, aufzeichnungswÃ¼rdigen, zu stabilisierenden Entscheidungen herauszudestillieren.</p><p></p><p></p><p>Zu berÃ¼cksichtigen sind dabei Kommandos wie Queries. Und was man da an Entscheidungen findet, ist in Events zu gieÃŸen, die beim Command-Handling generiert werden.</p><p></p><p></p><p>Dass ein Wurf stattgefunden hat, ist keine Entscheidung innerhalb einer LÃ¶sung. Aber wenn die Regeln von Frames sprechen, wenn es besondere Wurf-Kombinationen gibt und Boni zugesprochen werdenâ€¦ dann stecken dahinter Entscheidungen und die lohnen der Aufzeichnung â€fÃ¼r die Nachweltâ€œ.</p><p></p><p></p><p>Dazu mag noch kommen, Begriffe der DomÃ¤ne materialisieren. Wenn in den Regeln â€Frameâ€œ, â€Spareâ€œ, â€Strikeâ€œ, â€Bonusâ€œ als Begriffe vorkommen, dann liegt es nahe zu erwarten, sie in einem Eventstrom zu finden.</p><p></p><p></p><p>Das sind lohnende Erkenntnisse aus der Ãœbung. Ein schÃ¶nes Beispiel fÃ¼r <em>deliberate practice</em>. FÃ¼r mich hat sich die Challenge also gelohnt. Ich bin mir klarer geworden Ã¼ber Prinzipien und Heuristiken des Event Sourcing. Damit werde ich in die nÃ¤chste Challenge gehenâ€¦ Stay tuned!ğŸ˜</p><p>Â </p><p>Endnoten:</p><p></p><p></p><ol><li id="fn1">Materialismus verstehe ich hier als Haltung, die annimmt, dass es auÃŸerhalb von Software eine RealitÃ¤t gibt, die es sich lohnt, 1:1 innerhalb der Software mit stabilen Datenstrukturen abzubilden.<br>Konstruktivismus hingegen macht fÃ¼r mich keine solche Annahme. Er konstruiert nach Bedarf immer wieder neue ReprÃ¤sentationen aus â€rohen Wahrnehmungenâ€œ, die nicht mehr und nicht weniger als nÃ¼tzlich sind. Ob sie einer â€objektiven RealitÃ¤tâ€œ entsprechen oder nicht, ist ihm einerlei. <a href="#ffn1">â†©</a></li><li id="fn2">Antifragil ist Software bzw. die Softwareentwicklung fÃ¼r mich, wenn sie Ã„nderungswÃ¼nsche begrÃ¼ÃŸt. Dann trÃ¤gt jede Ã„nderung dazu bei, dass Software besser wird und sogar besser im besser werden. <a href="#ffn2">â†©</a></li><li id="fn3">Auf eine CRUD-Aufgabe habe ich verzichtet, weil die wohl NaserÃ¼mpfen bei einigen Event Sourcing Freunden hervorgerufen hÃ¤tte. Die Meinung, dass Event Sourcing sich nicht fÃ¼r CRUD-Szenarien lohne, hÃ¤lt sich noch. Ich bin allerdings anderer Ansicht. Aber davon ein andermal mehr. <a href="#ffn3">â†©</a></li><li id="fn4">Und das Ergebnis scheinen mir dann auch oft DomÃ¤nenevents zu sein, die ich in CQNS <a href="https://ralfw.de/command-query-notification-separation-cqns/">Notifications</a> nenne.<br>DomÃ¤nenevents sind fÃ¼r mich Nachrichten, die zwischen â€Akteurenâ€œ flieÃŸen. Das bedeutet nicht, dass sie 1:1 in einem Eventstrom aufgezeichnet werden. <a href="#ffn4">â†©</a></li><li id="fn5">Nur bei @sebastian gibt es eine Frame-Nummer, die implizit eine relativ leichte Erkennung des Spielendes erlaubt, weil jedes Spiel aus 10 Frames besteht. <a href="#ffn5">â†©</a></li></ol><p></p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on 27.01.2021</p><ul class="post__tag"><li><a href="https://ralfw.de/tags/event-orientation/">Event-Orientation</a></li></ul><div class="post__share"></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://ralfw.de/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://ralfw.de/magically-predictable-software-production-for-projects/" class="invert post__nav-link" rel="prev"><span>Previous</span> Magically Predictable Software Production for Projects</a></div><div class="post__nav-next"><a href="https://ralfw.de/wert-mehr-als-komplexitaet/" class="invert post__nav-link" rel="next"><span>Next</span> Wert mehr als KomplexitÃ¤t </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://ralfw.de/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav></main><footer class="footer"><div class="footer__copyright"><p>One Man Think Tank @ Nomad Nation OOD - Sofia, Bulgaria - <a href="../../../../../../imprint">Imprint</a> - <a href="../../../../../../data-privacy-policy">Data Privacy Policy</a></p></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://ralfw.de/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://ralfw.de/assets/js/scripts.min.js?v=f4c4d35432d0e17d212f2fae4e0f8247"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>